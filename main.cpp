#define GLFW_INCLUDE_NONE
#include <GLFW/glfw3.h>
#include <glbinding/gl/gl.h>
#include <glbinding/glbinding.h>
#include <iostream>

// void drawFrame() {
//   glClear(GL_COLOR_BUFFER_BIT);
//   glLineWidth(5);
//   glDrawArrays(GL_LINES, 0, 6);
// }

auto loadVertices() {
  float vertices[] = {
      1.,     -0.5,    0.5, 1.,     -0.25,   0.5, 1.5,    -0.5,    0.,
      1.,     -0.25,   0.5, 1.,     -0.5,    0.5, 1.5,    -0.5,    0.5,
      1.,     -0.5,    0.5, 1.5,    -0.5,    0.,  1.5,    -0.5,    0.5,
      1.5,    -0.5,    0.,  1.,     -0.25,   0.5, 1.5,    -0.5,    0.5,
      -0.5,   -1.,     0.,  -0.5,   -1.,     0.5, -1.,    -1.,     0.,
      -0.5,   -1.,     0.5, -0.5,   -1.,     0.,  -0.5,   -0.5,    0.5,
      -0.5,   -1.,     0.,  -1.,    -1.,     0.,  -0.5,   -0.5,    0.5,
      -1.,    -1.,     0.,  -0.5,   -1.,     0.5, -0.5,   -0.5,    0.5,
      -0.5,   -0.25,   0.5, -1.,    0.,      0.,  -0.5,   0.,      0.,
      -1.,    0.,      0.,  -0.5,   -0.25,   0.5, -1.,    0.,      0.5,
      -0.5,   -0.25,   0.5, -0.5,   0.,      0.,  -1.,    0.,      0.5,
      -0.5,   0.,      0.,  -1.,    0.,      0.,  -1.,    0.,      0.5,
      0.,     -0.5,    0.5, -0.125, -0.1875, 0.5, -0.25,  -0.375,  0.5,
      -0.125, -0.1875, 0.5, 0.,     -0.5,    0.5, 0.,     -0.5,    0.,
      0.,     -0.5,    0.5, -0.25,  -0.375,  0.5, 0.,     -0.5,    0.,
      -0.25,  -0.375,  0.5, -0.125, -0.1875, 0.5, 0.,     -0.5,    0.,
      0.625,  -0.1875, 0.5, 0.25,   -0.375,  0.5, 0.5,    -0.5,    0.,
      0.25,   -0.375,  0.5, 0.625,  -0.1875, 0.5, 0.25,   -0.375,  0.,
      0.625,  -0.1875, 0.5, 0.5,    -0.5,    0.,  0.25,   -0.375,  0.,
      0.5,    -0.5,    0.,  0.25,   -0.375,  0.5, 0.25,   -0.375,  0.,
      1.5,    -1.,     0.5, 1.5,    -0.5,    0.5, 1.,     -0.5,    0.5,
      1.5,    -0.5,    0.5, 1.5,    -1.,     0.5, 1.,     -1.,     0.,
      1.5,    -1.,     0.5, 1.,     -0.5,    0.5, 1.,     -1.,     0.,
      1.,     -0.5,    0.5, 1.5,    -0.5,    0.5, 1.,     -1.,     0.,
      1.,     -0.5,    0.5, 1.5,    -0.5,    0.,  1.,     -1.,     0.,
      1.5,    -0.5,    0.,  1.5,    -0.5,    0.5, 1.,     -1.,     0.,
      0.25,   -0.375,  0.,  0.25,   -0.5,    0.5, 0.5,    -0.5,    0.,
      0.25,   -0.5,    0.5, 0.25,   -0.375,  0.,  0.25,   -0.5,    0.,
      0.25,   -0.375,  0.,  0.5,    -0.5,    0.,  0.25,   -0.5,    0.,
      0.5,    -0.5,    0.,  0.25,   -0.5,    0.5, 0.25,   -0.5,    0.,
      1.5,    0.,      0.5, 1.5,    0.,      0.,  1.,     0.,      0.5,
      1.5,    0.,      0.,  1.5,    0.,      0.5, 1.,     -0.25,   0.5,
      1.5,    0.,      0.5, 1.,     0.,      0.5, 1.,     -0.25,   0.5,
      1.,     0.,      0.5, 1.5,    0.,      0.,  1.,     -0.25,   0.5,
      1.5,    -1.,     0.,  1.5,    -0.5,    0.5, 1.5,    -1.,     0.5,
      1.5,    -0.5,    0.5, 1.5,    -1.,     0.,  1.,     -1.,     0.,
      1.5,    -1.,     0.,  1.5,    -1.,     0.5, 1.,     -1.,     0.,
      -1.,    0.,      0.5, -1.,    0.,      0.,  -1.,    -0.5,    0.5,
      -1.,    0.,      0.,  -0.5,   -0.25,   0.5, -1.,    -0.5,    0.5,
      -0.5,   -0.25,   0.5, -1.,    0.,      0.5, -1.,    -0.5,    0.5,
      1.5,    -0.5,    0.,  1.,     -0.25,   0.5, 1.5,    0.,      0.,
      1.5,    -0.5,    0.,  1.5,    0.,      0.,  1.5,    -0.5,    0.5,
      1.5,    0.,      0.,  1.,     -0.25,   0.5, 1.5,    -0.5,    0.5,
      1.5,    -0.5,    0.,  1.5,    -0.5,    0.5, 1.5,    -1.,     0.,
      1.5,    -0.5,    0.,  1.5,    -1.,     0.,  1.,     -1.,     0.,
      -0.5,   -0.25,   0.5, -0.25,  -0.375,  0.5, -0.125, -0.1875, 0.5,
      -0.25,  -0.375,  0.5, -0.5,   -0.25,   0.5, -0.5,   -0.25,   0.,
      -0.5,   -0.25,   0.5, -0.125, -0.1875, 0.5, -0.5,   -0.25,   0.,
      -0.125, -0.1875, 0.5, -0.25,  -0.375,  0.5, -0.5,   -0.25,   0.,
      1.5,    -1.,     0.5, 1.,     -0.5,    0.5, 1.,     -1.,     0.5,
      1.5,    -1.,     0.5, 1.,     -1.,     0.5, 1.,     -1.,     0.,
      1.,     -1.,     0.5, 1.,     -0.5,    0.5, 1.,     -1.,     0.,
      1.,     -0.5,    0.,  1.,     -0.5,    0.5, 1.5,    -0.5,    0.,
      1.,     -0.5,    0.5, 1.,     -0.5,    0.,  1.,     -1.,     0.,
      1.,     -0.5,    0.,  1.5,    -0.5,    0.,  1.,     -1.,     0.,
      1.,     0.,      0.5, 1.,     -0.25,   0.5, 1.,     0.,      0.,
      1.,     -0.25,   0.5, 1.,     0.,      0.5, 0.625,  -0.1875, 0.5,
      1.,     0.,      0.5, 1.,     0.,      0.,  0.625,  -0.1875, 0.5,
      1.,     0.,      0.,  1.,     -0.25,   0.5, 0.625,  -0.1875, 0.5,
      1.,     -0.25,   0.,  1.5,    0.,      0.,  1.5,    -0.5,    0.,
      1.5,    0.,      0.,  1.,     -0.25,   0.,  1.,     -0.25,   0.5,
      1.,     -0.25,   0.,  1.5,    -0.5,    0.,  1.,     -0.25,   0.5,
      0.75,   -0.375,  0.5, 0.5,    -0.5,    0.,  0.75,   -0.375,  0.,
      0.5,    -0.5,    0.,  0.75,   -0.375,  0.5, 0.625,  -0.1875, 0.,
      0.75,   -0.375,  0.5, 0.75,   -0.375,  0.,  0.625,  -0.1875, 0.,
      0.75,   -0.375,  0.,  0.5,    -0.5,    0.,  0.625,  -0.1875, 0.,
      0.25,   -0.375,  0.5, 0.5,    -0.5,    0.,  0.5,    -0.5,    0.5,
      0.25,   -0.375,  0.5, 0.5,    -0.5,    0.5, 0.625,  -0.1875, 0.5,
      0.5,    -0.5,    0.5, 0.5,    -0.5,    0.,  0.625,  -0.1875, 0.5,
      -0.25,  -0.375,  0.5, -0.5,   -0.25,   0.,  -0.25,  -0.375,  0.,
      -0.5,   -0.25,   0.,  -0.25,  -0.375,  0.5, -0.125, -0.1875, 0.,
      -0.25,  -0.375,  0.5, -0.25,  -0.375,  0.,  -0.125, -0.1875, 0.,
      -0.25,  -0.375,  0.,  -0.5,   -0.25,   0.,  -0.125, -0.1875, 0.,
      1.5,    0.,      0.,  1.5,    0.,      0.5, 1.5,    -0.5,    0.5,
      1.5,    0.,      0.5, 1.,     -0.25,   0.5, 1.5,    -0.5,    0.5,
      0.25,   -0.5,    0.5, 0.5,    -0.5,    0.,  0.25,   -0.375,  0.5,
      0.25,   -0.375,  0.,  0.25,   -0.5,    0.5, 0.25,   -0.375,  0.5,
      -0.5,   -0.25,   0.5, -0.5,   -0.25,   0.,  -1.,    0.,      0.,
      -0.5,   -0.25,   0.,  -0.5,   -0.25,   0.5, -1.,    -0.5,    0.,
      -0.5,   -0.25,   0.5, -1.,    0.,      0.,  -1.,    -0.5,    0.,
      -1.,    0.,      0.,  -0.5,   -0.25,   0.,  -1.,    -0.5,    0.,
      -0.25,  -0.375,  0.5, 0.,     -0.5,    0.,  -0.125, -0.1875, 0.,
      0.,     -0.5,    0.,  -0.25,  -0.375,  0.5, -0.25,  -0.375,  0.,
      -0.125, -0.1875, 0.,  0.,     -0.5,    0.,  -0.25,  -0.375,  0.,
      -0.125, -0.1875, 0.,  -0.5,   -0.25,   0.,  -0.5,   0.,      0.,
      -0.5,   -0.25,   0.,  -0.125, -0.1875, 0.,  -0.125, -0.1875, 0.5,
      -0.125, -0.1875, 0.,  -0.5,   0.,      0.,  -0.125, -0.1875, 0.5,
      -0.5,   0.,      0.,  -0.5,   -0.25,   0.,  -0.125, -0.1875, 0.5,
      1.,     -0.25,   0.,  0.625,  -0.1875, 0.5, 1.,     -0.25,   0.5,
      0.625,  -0.1875, 0.5, 1.,     -0.25,   0.,  0.75,   -0.375,  0.5,
      1.,     -0.25,   0.,  1.,     -0.25,   0.5, 0.75,   -0.375,  0.5,
      1.,     -0.25,   0.5, 0.625,  -0.1875, 0.5, 0.75,   -0.375,  0.5,
      -0.25,  -0.375,  0.5, -0.125, -0.1875, 0.5, -0.125, -0.1875, 0.,
      -0.125, -0.1875, 0.5, 0.,     -0.5,    0.,  -0.125, -0.1875, 0.,
      1.,     0.,      0.,  1.5,    0.,      0.,  1.,     -0.25,   0.,
      1.5,    0.,      0.,  1.,     0.,      0.,  1.,     -0.25,   0.5,
      1.,     0.,      0.,  1.,     -0.25,   0.,  1.,     -0.25,   0.5,
      1.,     0.,      0.5, 1.5,    0.,      0.,  1.,     0.,      0.,
      1.,     -0.5,    0.,  1.,     -0.25,   0.,  1.5,    -0.5,    0.,
      1.,     -0.25,   0.,  1.,     -0.5,    0.,  1.,     -0.25,   0.5,
      1.,     -0.5,    0.,  1.5,    -0.5,    0.,  1.,     -0.25,   0.5,
      1.,     -0.5,    0.,  1.,     -0.5,    0.5, 1.,     -0.25,   0.5,
      0.5,    -0.5,    0.,  0.625,  -0.1875, 0.,  0.625,  -0.1875, 0.5,
      0.625,  -0.1875, 0.,  0.5,    -0.5,    0.,  0.25,   -0.375,  0.,
      0.625,  -0.1875, 0.5, 0.625,  -0.1875, 0.,  0.25,   -0.375,  0.,
      -0.5,   -0.25,   0.5, -0.5,   -0.5,    0.,  -0.5,   -0.25,   0.,
      -0.5,   -0.5,    0.,  -0.5,   -0.25,   0.5, -1.,    -0.5,    0.,
      -0.5,   -0.25,   0.,  -0.5,   -0.5,    0.,  -1.,    -0.5,    0.,
      0.75,   -0.375,  0.5, 0.625,  -0.1875, 0.5, 0.5,    -0.5,    0.,
      0.625,  -0.1875, 0.5, 0.75,   -0.375,  0.5, 0.625,  -0.1875, 0.,
      0.75,   -0.375,  0.5, 0.625,  -0.1875, 0.,  1.,     -0.25,   0.,
      0.625,  -0.1875, 0.,  0.625,  -0.1875, 0.5, 1.,     -0.25,   0.,
      0.625,  -0.1875, 0.5, 1.,     0.,      0.,  1.,     -0.25,   0.,
      1.,     -0.25,   0.,  0.75,   -0.375,  0.5, 0.75,   -0.375,  0.,
      0.625,  -0.1875, 0.,  1.,     -0.25,   0.,  0.75,   -0.375,  0.,
      -0.5,   -0.25,   0.5, -0.5,   0.,      0.,  -0.125, -0.1875, 0.5,
      -0.5,   0.,      0.,  -0.5,   -0.25,   0.5, -0.5,   0.,      0.5,
      -0.5,   -0.25,   0.5, -0.125, -0.1875, 0.5, -0.5,   0.,      0.5,
      -0.125, -0.1875, 0.5, -0.5,   0.,      0.,  -0.5,   0.,      0.5,
      -0.125, -0.1875, 0.5, 0.,     -0.5,    0.,  0.25,   -0.375,  0.5,
      0.,     -0.5,    0.,  -0.125, -0.1875, 0.5, 0.25,   -0.375,  0.,
      -0.125, -0.1875, 0.5, 0.25,   -0.375,  0.5, 0.25,   -0.375,  0.,
      0.25,   -0.375,  0.5, 0.,     -0.5,    0.,  0.25,   -0.375,  0.,
      -0.5,   -0.5,    0.5, -0.5,   -1.,     0.,  -0.5,   -0.5,    0.,
      -0.5,   -1.,     0.,  -1.,    -1.,     0.,  -0.5,   -0.5,    0.,
      -1.,    -1.,     0.,  -0.5,   -0.5,    0.5, -0.5,   -0.5,    0.,
      -0.5,   -0.5,    0.5, -0.5,   -0.5,    0.,  -0.5,   -0.25,   0.5,
      -0.5,   -0.5,    0.,  -0.5,   -0.5,    0.5, -1.,    -0.5,    0.,
      -0.5,   -0.5,    0.5, -0.5,   -0.25,   0.5, -1.,    -0.5,    0.,
      0.,     -0.5,    0.,  0.25,   -0.5,    0.5, 0.25,   -0.375,  0.,
      0.25,   -0.5,    0.5, 0.,     -0.5,    0.,  0.25,   -0.5,    0.,
      0.,     -0.5,    0.,  0.25,   -0.375,  0.,  0.25,   -0.5,    0.,
      -1.,    -0.5,    0.5, -1.,    0.,      0.,  -1.,    -0.5,    0.,
      -0.5,   -0.25,   0.5, -1.,    -0.5,    0.5, -1.,    -0.5,    0.,
      -1.,    0.,      0.5, -0.5,   -0.25,   0.5, -0.5,   0.,      0.5,
      -0.5,   0.,      0.,  -1.,    0.,      0.5, -0.5,   0.,      0.5,
      0.75,   -0.375,  0.5, 0.625,  -0.1875, 0.5, 0.5,    -0.5,    0.5,
      0.75,   -0.375,  0.5, 0.5,    -0.5,    0.5, 0.5,    -0.5,    0.,
      0.25,   -0.5,    0.5, 0.25,   -0.375,  0.5, 0.,     -0.5,    0.,
      0.25,   -0.5,    0.5, 0.25,   -0.375,  0.5, 0.,     -0.5,    0.5,
      0.25,   -0.375,  0.5, 0.,     -0.5,    0.,  0.,     -0.5,    0.5,
      0.,     -0.5,    0.,  0.25,   -0.5,    0.5, 0.,     -0.5,    0.5,
      1.,     0.,      0.,  1.,     -0.25,   0.,  0.625,  -0.1875, 0.,
      0.625,  -0.1875, 0.5, 1.,     0.,      0.,  0.625,  -0.1875, 0.,
      0.,     -0.5,    0.,  -0.125, -0.1875, 0.,  0.25,   -0.375,  0.,
      -0.125, -0.1875, 0.,  -0.125, -0.1875, 0.5, 0.25,   -0.375,  0.,
      -0.5,   -1.,     0.5, -1.,    -1.,     0.5, -1.,    -1.,     0.,
      -1.,    -1.,     0.5, -0.5,   -1.,     0.5, -1.,    -0.5,    0.5,
      -0.5,   -1.,     0.5, -1.,    -1.,     0.,  -1.,    -0.5,    0.5,
      -1.,    -1.,     0.,  -1.,    -1.,     0.5, -1.,    -0.5,    0.5,
      -0.5,   -0.5,    0.5, -1.,    -0.5,    0.5, -1.,    -1.,     0.,
      -1.,    -0.5,    0.5, -0.5,   -0.5,    0.5, -1.,    -0.5,    0.,
      -0.5,   -0.5,    0.5, -1.,    -1.,     0.,  -1.,    -0.5,    0.,
      -1.,    -1.,     0.,  -1.,    -0.5,    0.5, -1.,    -0.5,    0.,
      -0.5,   0.,      0.,  -0.5,   -0.25,   0.,  -0.5,   -0.25,   0.5,
      -0.5,   -0.5,    0.,  -1.,    -1.,     0.,  -1.,    -0.5,    0.,
      -0.5,   -0.25,   0.5, -1.,    -0.5,    0.5, -0.5,   -0.5,    0.5,
      0.25,   -0.375,  0.5, -0.125, -0.1875, 0.5, 0.,     -0.5,    0.5,
      -1.,    0.,      0.,  -0.5,   0.,      0.,  -0.5,   -0.25,   0.,
      -0.5,   -1.,     0.5, -0.5,   -0.5,    0.5, -1.,    -0.5,    0.5,
      0.5,    -0.5,    0.,  0.5,    -0.5,    0.5, 0.25,   -0.5,    0.5,
      0.5,    -0.5,    0.5, 0.25,   -0.375,  0.5, 0.25,   -0.5,    0.5};

  gl::GLuint vbo;
  gl::GLuint vao;

  gl::glGenVertexArrays(1, &vao);
  gl::glBindVertexArray(vao);

  gl::glGenBuffers(1, &vbo);
  gl::glBindBuffer(gl::GL_ARRAY_BUFFER, vbo);

  gl::glBufferData(gl::GL_ARRAY_BUFFER, sizeof(vertices), vertices,
                   gl::GL_STATIC_DRAW);

  gl::glVertexAttribPointer(0, 3, gl::GLenum::GL_FLOAT, gl::GL_TRUE, 0, NULL);
  gl::glEnableVertexAttribArray(0);

  return vao;
}

auto loadVertexShader() {
  const char *shaderSource =
#include "shader.vert"
      ;
  auto shader = gl::glCreateShader(gl::GL_VERTEX_SHADER);
  gl::glShaderSource(shader, 1, &shaderSource, NULL);
  gl::glCompileShader(shader);
  return shader;
}

auto loadFragmentShader() {
  const char *shaderSource =
#include "shader.frag"
      ;
  auto shader = gl::glCreateShader(gl::GL_FRAGMENT_SHADER);
  gl::glShaderSource(shader, 1, &shaderSource, NULL);
  gl::glCompileShader(shader);
  return shader;
}

auto loadShaderProgram() {
  auto shaderProgram = gl::glCreateProgram();
  auto fragShader = loadFragmentShader();
  auto vertShader = loadVertexShader();
  gl::glAttachShader(shaderProgram, fragShader);
  gl::glAttachShader(shaderProgram, vertShader);
  gl::glLinkProgram(shaderProgram);

  gl::glDeleteShader(fragShader);
  gl::glDeleteShader(vertShader);
  return shaderProgram;
}

int main() {
  if (!glfwInit()) {
    std::cerr << "Failed to initialize GLFW";
    return -1;
  }
  glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, 3);
  glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, 3);
  glfwWindowHint(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);

  auto window = glfwCreateWindow(640, 480, "Lab 6 Computer Graphics", NULL, NULL);
  if (!window) {
    std::cerr << "Failed to create window";
    glfwTerminate();
    return -2;
  }

  glfwMakeContextCurrent(window);

  glbinding::initialize(glfwGetProcAddress);

  auto vao = loadVertices();
  auto shaderProgram = loadShaderProgram();

  while (!glfwWindowShouldClose(window)) {
    gl::glClear(gl::GL_COLOR_BUFFER_BIT | gl::GL_DEPTH_BUFFER_BIT);
    gl::glUseProgram(shaderProgram);
    gl::glBindVertexArray(vao);
    gl::glDrawArrays(gl::GLenum::GL_TRIANGLES, 0, 1452);

    /* Swap front and back buffers */
    glfwSwapBuffers(window);

    // /* Poll for and process events */
    glfwPollEvents();
  }
  glfwTerminate();
}
